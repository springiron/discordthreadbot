# â˜ï¸ GCPä¸Šã§Discord Botã‚’æ§‹ç¯‰ãƒ»å¸¸æ™‚ç¨¼åƒã•ã›ã‚‹æ‰‹é †ï¼ˆGitã‚ã‚Šãƒ»ãªã— ä¸¡å¯¾å¿œï¼‰

---

## ğŸ–¥ï¸ ã‚¹ãƒ†ãƒƒãƒ—0ï¼šGCP VMã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ

1. GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹: https://console.cloud.google.com/
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ ã€ŒCompute Engineã€â†’ã€ŒVMã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€â†’ã€Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã€
3. ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã†ï¼š
   - åå‰: `discord-bot-server`
   - ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: `asia-northeast1`ï¼ˆä¾‹ï¼šæ±äº¬ï¼‰
   - ãƒã‚·ãƒ³ã‚¿ã‚¤ãƒ—: `e2-micro`ï¼ˆç„¡æ–™æ ï¼‰ã¾ãŸã¯ `e2-small`
   - ãƒ–ãƒ¼ãƒˆãƒ‡ã‚£ã‚¹ã‚¯: `Ubuntu 20.04 LTS` ã¾ãŸã¯ `22.04`
   - ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«: ãƒã‚§ãƒƒã‚¯ä¸è¦ï¼ˆBotã®ã¿å‹•ä½œã®å ´åˆï¼‰

---

# âœ… Part 1: Gitã‚’ä½¿ã£ãŸæ§‹ç¯‰æ‰‹é †ï¼ˆQiitaè¨˜äº‹ãƒ™ãƒ¼ã‚¹ï¼‰

---

## ğŸ“¦ ã‚¹ãƒ†ãƒƒãƒ—1: Python3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
sudo apt update
sudo apt install python3
python3 --version
```

## ğŸ“¦ ã‚¹ãƒ†ãƒƒãƒ—2: pipã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
sudo apt install python3-pip
pip3 --version
```

## ğŸŒ ã‚¹ãƒ†ãƒƒãƒ—3: Gitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
sudo apt update
sudo apt install git -y
git --version
```

## ğŸ”‘ ã‚¹ãƒ†ãƒƒãƒ—4: SSHéµã®ç”Ÿæˆã¨GitHubç™»éŒ²

```bash
ssh-keygen -t ed25519 -C "your-email@example.com"
cat ~/.ssh/id_ed25519.pub
```

â€»å…¬é–‹éµã‚’GitHubã®ã€ŒSSH and GPG keysã€ã«ç™»éŒ²

## ğŸ—ƒï¸ ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone git@github.com:yourusername/yourrepository.git
cd yourrepository
```

## ğŸ ã‚¹ãƒ†ãƒƒãƒ—6: ä»®æƒ³ç’°å¢ƒã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—7: Botã®èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰

```bash
nohup bash -c 'source .venv/bin/activate && python3 main.py' > output.log 2>&1 &
tail -f output.log
```

## ğŸ›‘ ã‚¹ãƒ†ãƒƒãƒ—8: Botã®åœæ­¢

```bash
ps aux | grep python3
kill <PID>
```

---

# âœ… Part 2: Gitã‚’ä½¿ã‚ãšã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§æ§‹ç¯‰ã™ã‚‹æ–¹æ³•

---

## ğŸ“¤ ã‚¹ãƒ†ãƒƒãƒ—1ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’GCPã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### æ–¹æ³•Aï¼šscpï¼ˆMac/Linux/WSLï¼‰

```bash
scp -r -i ~/.ssh/YOUR_PRIVATE_KEY ./mybot your_username@VM_IP_ADDRESS:~/
```

### æ–¹æ³•Bï¼šWindowsï¼ˆWinSCPï¼‰

1. WinSCPã‚’é–‹ã
2. ãƒ›ã‚¹ãƒˆå: `VMã®IP`
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼å: `ubuntu`
4. ç§˜å¯†éµ: `.ppk` ã‚’æŒ‡å®š
5. ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

---

## ğŸ“¦ ã‚¹ãƒ†ãƒƒãƒ—2ï¼šPython & ä»®æƒ³ç’°å¢ƒè¨­å®š

```bash
sudo apt update
sudo apt install python3 python3-pip -y
cd ~/mybot
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt  # ã¾ãŸã¯ pip install discord.py
```

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—3ï¼šBotã®å¸¸æ™‚èµ·å‹•ï¼ˆè¤‡æ•°å¯¾å¿œï¼‰

### æ–¹æ³•Aï¼šnohupã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ

```bash
nohup bash -c 'source .venv/bin/activate && python3 main.py' > output.log 2>&1 &
tail -f output.log
```

### æ–¹æ³•Bï¼štmuxã§æ°¸ç¶šå®Ÿè¡Œ

```bash
sudo apt install tmux
tmux new -s bot1
source .venv/bin/activate
python3 main.py
# Ctrl + b â†’ d ã§é›¢è„±
tmux attach -t bot1
```

### æ–¹æ³•Cï¼šsystemdã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹åŒ–ï¼ˆæ¨å¥¨ï¼‰

```bash
sudo nano /etc/systemd/system/bot1.service
```

```ini
[Unit]
Description=Discord Bot 1
After=network.target

[Service]
User=ubuntu
WorkingDirectory=/home/ubuntu/mybot
ExecStart=/home/ubuntu/mybot/.venv/bin/python3 /home/ubuntu/mybot/main.py
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable bot1
sudo systemctl start bot1
sudo systemctl status bot1
journalctl -u bot1 -f
```

---

## ğŸ“ è¤‡æ•°Botæ§‹æˆä¾‹

```plaintext
~/bots/
â”œâ”€â”€ bot1/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ .venv/
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ bot2/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ .venv/
â”‚   â””â”€â”€ requirements.txt
```

---

## ğŸ”’ è£œè¶³ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨é‹ç”¨Tips

- `.env` ã‚„ `secrets.toml` ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ï¼ˆGitç®¡ç†ã—ãªã„ï¼‰
- ä¸è¦ãªãƒãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹å ´åˆï¼š

```bash
sudo ufw allow OpenSSH
sudo ufw enable
```

---

## âœ… ã¾ã¨ã‚

| é …ç›®         | å†…å®¹                                           |
|--------------|------------------------------------------------|
| èµ·å‹•æ–¹å¼     | `nohup`, `tmux`, `systemd`ï¼ˆæ¨å¥¨ï¼‰             |
| è¤‡æ•°Bot      | ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘ï¼‹systemdã‚„tmuxã§å€‹åˆ¥ç®¡ç†         |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | `.env`ç®¡ç† + SSHéµæ¥ç¶š + UFWåˆ¶é™               |
